app.directive("usernameValidator",["$http","$q",function(e,o){return{require:"ngModel",link:function(r,s,t,n){console.log(s),console.log(t),console.log(r),n.$asyncValidators.userName=function(r,s){return e.post("http://localhost:8080/user/checkIfExists?userName="+s).then(function(e){return console.log(e),1!=e.data||(n.$error.alreadyTaken=!0,o.reject())})}}}}]),app.directive("spinner",[function(){return{restrict:"E",template:'<div ng-if="pending !== undefined && pending"><i class="fa fa-spinner fa-spin fa-1x"></i></div>',scope:{pending:"@"}}}]),app.directive("showMessage",[function(){return{restrict:"E",templateUrl:"directives/showMessage.html",scope:{formControl:"=",fieldLabel:"@"}}}]),app.service("UserService",["$resource",function(e){var o=e("http://localhost:8080/user",{},{create:{method:"POST"},login:{method:"POST",url:"http://localhost:8080/user/login"}});this.createUser=function(e){return o.create(e)},this.login=function(e){return o.login(e)}}]),app.controller("UserController",["UserService","$scope","$cookies","$state",function(e,o,r,s){o.value="Hello User",o.regex="((?=.*\\d)(?=.*[a-z])(?=.*[@#$%]).{6,10})",o.user={userName:"",password:"",fName:"",lName:"",mName:"",phoneNumber:"",dob:null},o.login={userName:"",password:""},o.signup=function(){e.createUser(o.user).$promise.then(function(e){console.log(e),o.resetForm(),s.go("login")},function(e){console.log(e)})},o.loginToApp=function(){e.login(o.login).$promise.then(function(e){r.put("loggedInUser",JSON.stringify(e)),s.go("courses")},function(e){console.log(e)})},o.resetForm=function(){o.user={userName:"",password:"",fName:"",lName:"",mName:"",phoneNumber:"",dob:null},o.signupForm.$setPristine(),o.signupForm.$setUntouched()}}]),app.service("CourseService",["$resource",function(e){this.selectedCourse=null;var o=e("http://localhost:8080/course",{},{getAll:{method:"GET",isArray:!0},getAllForUser:{method:"GET",isArray:!0,params:{userId:"@userId"},url:"http://localhost:8080/course/user/:userId"},getCourseById:{method:"GET",params:{courseId:"@courseId"},url:"http://localhost:8080/course/:courseId"},create:{method:"POST"}});this.getAllCourses=function(){return o.getAll()},this.getAllRegisteredCourses=function(e){return console.log(e),o.getAllForUser({userId:e})},this.saveCourse=function(e){return o.create(e)},this.getCourseById=function(e){return o.getCourseById({courseId:e})},this.setSelectedCourse=function(e){this.selectedCourse=e}}]),app.controller("CourseController",["CourseService","$scope","$cookies","$state","$stateParams",function(e,o,r,s,t){o.courses=null,o.registeredCourses=null,o.pageTitle="Add Course";var n=function(){return{name:"",duration:""}};o.course={name:"",author:"",level:"BEGINNER",description:"",prereqs:"",fee:"",endGoal:"",type:"Free",topics:[n(),n()]};var u,l=r.get("loggedInUser");void 0!=l&&(u=JSON.parse(l)),e.getAllRegisteredCourses(u.userId).$promise.then(function(e){o.registeredCourses=e}),e.getAllCourses().$promise.then(function(e){for(index=0;index<e.length;++index)e[index].imgSrc="http://lorempixel.com/80/80/people?random="+index;o.courses=e}),o.addNewTopic=function(){o.course.topics.push(n())},o.removeTopic=function(e){o.course.topics.pop(e)},o.saveCourse=function(){var t=r.get("loggedInUser");o.course.author=JSON.parse(t).userName,console.log(o.course),e.saveCourse(o.course).$promise.then(function(){s.go("courses")},function(e){console.log(e)})},o.displayTopics=function(o){e.setSelectedCourse(o),s.go("courseTopics",{courseId:o.courseId})},void 0!==t.courseId&&(o.pageTitle="Edit Course",e.getCourseById(t.courseId).$promise.then(function(e){o.course=e},function(e){console.log(e)}))}]),app.controller("TopicsController",["CourseService","$scope","$cookies","$state","$stateParams",function(e,o,r,s,t){o.selectedCourse=e.selectedCourse,o.loggedInUser=JSON.parse(r.get("loggedInUser")),o.register=function(){},o.editCourse=function(){s.go("courseEdit",{courseId:o.selectedCourse.courseId})}}]),app.config(["$stateProvider","$urlRouterProvider",function(e,o){o.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"user/login.html",controller:"UserController"}).state("signup",{url:"/signup",templateUrl:"user/signup.html",controller:"UserController"}).state("courses",{url:"/courses",templateUrl:"course/course-list.html",controller:"CourseController"}).state("courseAdd",{url:"/addCourse",templateUrl:"course/course-add.html",controller:"CourseController"}).state("courseEdit",{url:"/editCourse/:courseId",templateUrl:"course/course-add.html",controller:"CourseController"}).state("courseTopics",{url:"/courseTopics/:courseId",templateUrl:"course/course-topics.html",controller:"TopicsController"})}]),app.run(["$rootScope","$cookies","$location",function(e,o,r){e.logOut=function(){o.remove("loggedInUser"),r.path("/login")},e.$on("$stateChangeStart",function(s,t,n){var u=o.get("loggedInUser");e.showLogout=!0,"login"===t.name||"signup"===t.name?e.showLogout=!1:void 0===u&&(s.preventDefault(),e.showLogout=!1,r.path("/login"))})}]);var app=angular.module("CourseApp",["ngResource","ngCookies","ui.router","ui.bootstrap","ngMask"]);